<%- include('partials/header') %>

<h1>Mongo Query Builder</h1>

<form>
    <div class="row my-3">
        <div class="col-3">
            <select id="collection" class="form-select">
            </select>
        </div>
    </div>
    <div id="rules"></div>

    <button type="button" class="btn btn-secondary mb-3" onclick="addRule()">
        + Aggiungi condizione
    </button>

    <input type="hidden" name="query" id="queryInput">

    <div class="mb-3">
        <label class="form-label fw-bold">Query Mongo (preview)</label>
        <div id="editor" style="height: 300px; border: 1px solid #ccc"></div>
    </div>

    <fieldset class="mb-3 p-3" style="border: 1px solid darkgray">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="mongoOptionsSwitch">
            <label class="form-check-label fw-bold" for="mongoOptionsSwitch">Opzioni Mongo</label>
        </div>
        <div id="mongoOptionsFields" class="my-3" style="display: none;">
            <div class="row g-3">
                <div class="col-12">
                    <div class="">
                        <label class="form-label fw-semibold">Ordinamento</label>
                        <div class="row g-3">
                            <div class="col-4">
                                <select id="sortField" class="form-select">
                                    <option value="">-- Nessun ordinamento --</option>
                                </select>
                            </div>
                            <div class="col-3">
                                <select id="sortOrder" class="form-select">
                                    <option value="1">Ascendente</option>
                                    <option value="-1">Discendente</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="">
                        <label class="form-label fw-semibold">Limit</label>
                        <input type="number" id="limit" class="form-control" min="1">
                    </div>
                </div>
                <div class="col-12">
                    <div class="">
                        <label class="form-label fw-semibold">Proiezione</label>
                        <div id="projectionFields" class="row g-3"></div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="optionsInput">
        </div>
    </fieldset>
    <fieldset class="mb-3 p-3" style="border: 1px solid darkgray">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="gridfsSwitch">
            <label class="form-check-label fw-bold" for="gridfsSwitch">GridFS</label>
        </div>
        <div id="gridfsFields" class="my-3" style="display: none;">
            <div class="row g-3">
                <div class="col-12">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="includeInitialData" checked>
                        <label class="form-check-label fw-semibold" for="includeInitialData">
                            Carica i dati della collection iniziale
                        </label>
                    </div>
                </div>
                <div class="col-4">
                    <label class="form-label fw-semibold">Nome campo per il match con GridFS(*)</label>
                    <input type="text" id="gridfsField" class="form-control" placeholder="Es: 'filename'" required>
                </div>
                <div class="col-4">
                    <label class="form-label fw-semibold">Prefisso nome campo</label>
                    <input type="text" id="gridfsPrefix" class="form-control" required>
                </div>
                <div class="col-4">
                    <label class="form-label fw-semibold">Suffisso nome campo</label>
                    <input type="text" id="gridfsSuffix" class="form-control" required>
                </div>
                <div class="col-4">
                    <label class="form-label fw-semibold">Campo per il match della collection GridFS(*)</label>
                    <select id="gridfsMatchField" class="form-select" required>
                        <option value="_id">_id</option>
                        <option value="filename">filename</option>
                    </select>
                </div>
            </div>

        </div>
    </fieldset>

    <button id="exec" type="button" class="btn btn-primary">Esegui</button>
    <a id="s3" href="/resultsS3" class="btn btn-warning">AWS S3 Bucket</a>

    <div hidden id="loading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="mt-2">Caricamento in corso...</div>
    </div>
</form>

<script src="/js/query-builder2.js"></script>
<script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
<script>
    require.config({
        paths: {
            vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs'
        }
    });

    require(['vs/editor/editor.main'], function () {
        window.initMonaco();
    });
</script>
<%- include('partials/footer') %>
